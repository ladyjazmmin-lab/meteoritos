<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Space Dodger Futurista</title>
  <style>
    body { margin: 0; overflow: hidden; background: black; }
    canvas { display: block; margin: auto; background: #000; }
  </style>
</head>
<body>
<h3> Meteoritos - Vladimir MOntaño </h3>
<canvas id="gameCanvas" width="600" height="800"></canvas>
<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

let keys = {};

// Player nave más estilizada y futurista
let player = {
  x: canvas.width/2,
  y: canvas.height-60,
  r: 16,
  speed: 6.5,
  shield: false,
  shieldTime: 0,
  boostTime: 0
};

// Arrays
let stars = [];
let asteroids = [];
let bullets = [];
let particles = [];

let lastTime = 0;
let score = 0;
let spawnRate = 900;

// Input
window.addEventListener("keydown", e => { keys[e.key] = true; });
window.addEventListener("keyup", e => { keys[e.key] = false; });

function circleCollision(c1, c2){
  if(!c1 || !c2) return false;
  let dx = c1.x - c2.x;
  let dy = c1.y - c2.y;
  let dist = Math.sqrt(dx*dx + dy*dy);
  return dist < c1.r + c2.r;
}

function reset(){
  asteroids = [];
  bullets = [];
  stars = [];
  particles = [];
  player.x = canvas.width/2;
  player.y = canvas.height-60;
  score = 0;
  spawnRate = 900;
  lastTime = 0;
}

function spawnAsteroid(){
  let x = Math.random()*canvas.width;
  let size = 18+Math.random()*32;
  let speed = 5+Math.random()*6 + score/150;
  let type = Math.floor(Math.random()*4);
  let colorSets = [
    {fill:"#555", stroke:"#aaa"},
    {fill:"#888", stroke:"#ddd"},
    {fill:"#a52a2a", stroke:"#ff6347"},
    {fill:"#daa520", stroke:"#ffd700"}
  ];
  asteroids.push({x, y:-size, r:size, speed, angle:Math.random()*Math.PI*2, rot:0.05, type, colors:colorSets[type]});
}

function spawnStar(){
  let x = Math.random()*canvas.width;
  let y = -5;
  let speed = 1+Math.random()*2;
  stars.push({x,y,speed});
}

function shoot(){
  bullets.push({x:player.x, y:player.y-player.r, r:5, speed:13});
}

function update(delta){
  // Mov player
  let actualSpeed = player.speed;
  if(player.boostTime>0){ actualSpeed = 10; player.boostTime -= delta; }

  if(keys["ArrowLeft"] && player.x>player.r) player.x -= actualSpeed;
  if(keys["ArrowRight"] && player.x<canvas.width-player.r) player.x += actualSpeed;
  if(keys["ArrowUp"] && player.y>player.r) player.y -= actualSpeed;
  if(keys["ArrowDown"] && player.y<canvas.height-player.r) player.y += actualSpeed;

  // Powers
  if(keys[" "]) {
    if(!player.shootCooldown){ shoot(); player.shootCooldown = 180; }
  }
  if(keys["Shift"] && !player.shield && player.shieldTime<=0){
    player.shield = true;
    player.shieldTime = 2200;
  }
  if(keys["Control"] && player.boostTime<=0){
    player.boostTime = 1200;
  }

  if(player.shootCooldown>0) player.shootCooldown -= delta;
  if(player.shield){
    player.shieldTime -= delta;
    if(player.shieldTime<=0){
      player.shield = false;
      player.shieldTime = 0;
    }
  }

  // Stars
  for(let s of stars){ s.y += s.speed; }
  stars = stars.filter(s=>s.y<canvas.height+5);

  // Bullets
  for(let b of bullets){ b.y -= b.speed; }
  bullets = bullets.filter(b=>b.y>-10);

  // Asteroids
  for(let a of asteroids){
    a.y += a.speed;
    a.angle += a.rot;

    if(circleCollision(player, a)){
      if(!player.shield){ reset(); return; }
    }

    for(let i=0;i<bullets.length;i++){
      if(circleCollision(bullets[i], a)){
        bullets.splice(i,1);
        asteroids.splice(asteroids.indexOf(a),1);
        score+=20;
        break;
      }
    }
  }
  asteroids = asteroids.filter(a=>a.y<canvas.height+a.r);

  // Partículas de propulsión
  particles.push({x:player.x+(Math.random()*8-4), y:player.y+player.r, size:2+Math.random()*3, life:500});
  for(let p of particles){ p.y+=2; p.life-=delta; }
  particles = particles.filter(p=>p.life>0);

  if(Math.random()<0.06) spawnStar();
  if(delta>0){
    spawnRate -= delta*0.12;
    if(spawnRate<70) spawnRate=70;
    if(Math.random()<delta/spawnRate) spawnAsteroid();
  }
}

function draw(){
  ctx.fillStyle = "black";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  ctx.fillStyle = "white";
  for(let s of stars){ ctx.fillRect(s.x,s.y,2,2); }

  // Sombra dinámica debajo de la nave
  ctx.save();
  ctx.fillStyle = "rgba(0,0,0,0.4)";
  ctx.beginPath();
  ctx.ellipse(player.x, player.y+player.r+10, player.r*1.2, 8, 0, 0, Math.PI*2);
  ctx.fill();
  ctx.restore();

  // Nave futurista
  ctx.save();
  ctx.translate(player.x, player.y);
  ctx.lineWidth = 2;

  let gradient = ctx.createLinearGradient(-player.r, -player.r, player.r, player.r);
  gradient.addColorStop(0, "#0ff");
  gradient.addColorStop(0.5, "#00aaff");
  gradient.addColorStop(1, "#0044ff");
  ctx.fillStyle = gradient;
  ctx.strokeStyle = "#0ff";
  ctx.beginPath();
  ctx.moveTo(0,-player.r-24);
  ctx.lineTo(player.r+12,player.r+12);
  ctx.lineTo(-player.r-12,player.r+12);
  ctx.closePath();
  ctx.fill();
  ctx.stroke();

  // Cabina brillante con reflejo
  let cabina = ctx.createRadialGradient(0,-player.r/1.5,2,0,-player.r/1.5,11);
  cabina.addColorStop(0,"#fff");
  cabina.addColorStop(1,"#00e5ff");
  ctx.fillStyle = cabina;
  ctx.beginPath();
  ctx.arc(0,-player.r/1.5,9,0,Math.PI*2);
  ctx.fill();

  // Luces LED laterales
  ctx.fillStyle = "#0ff";
  ctx.fillRect(-player.r-14, -5, 4, 12);
  ctx.fillRect(player.r+10, -5, 4, 12);

  // Propulsión con gradiente y partículas
  let fireGradient = ctx.createLinearGradient(0,player.r,0,player.r+50);
  fireGradient.addColorStop(0,"yellow");
  fireGradient.addColorStop(0.4,"orange");
  fireGradient.addColorStop(1,"red");
  ctx.fillStyle = fireGradient;
  ctx.beginPath();
  ctx.moveTo(-6,player.r+10);
  ctx.lineTo(0,player.r+35+Math.random()*18);
  ctx.lineTo(6,player.r+10);
  ctx.closePath();
  ctx.fill();

  if(player.shield){
    ctx.strokeStyle = "rgba(0,255,255,0.6)";
    ctx.lineWidth = 3;
    ctx.beginPath();
    ctx.arc(0,0,player.r+22,0,Math.PI*2);
    ctx.stroke();
  }
  ctx.restore();

  // Partículas de fuego
  for(let p of particles){
    ctx.fillStyle = `rgba(255,${100+Math.random()*155},0,${p.life/500})`;
    ctx.beginPath();
    ctx.arc(p.x,p.y,p.size,0,Math.PI*2);
    ctx.fill();
  }

  // Bullets
  ctx.fillStyle = "red";
  for(let b of bullets){ ctx.beginPath(); ctx.arc(b.x,b.y,b.r,0,Math.PI*2); ctx.fill(); }

  // Asteroides
  for(let a of asteroids){
    ctx.save();
    ctx.translate(a.x,a.y);
    ctx.rotate(a.angle);
    ctx.fillStyle = a.colors.fill;
    ctx.strokeStyle = a.colors.stroke;
    ctx.lineWidth = 2;
    ctx.beginPath();
    for(let i=0;i<10;i++){
      let angle = i*(Math.PI*2/10);
      let rad = a.r*(0.7+Math.random()*0.4);
      ctx.lineTo(Math.cos(angle)*rad, Math.sin(angle)*rad);
    }
    ctx.closePath();
    ctx.fill();
    ctx.stroke();
    ctx.restore();
  }

  ctx.fillStyle = "white";
  ctx.font = "16px Arial";
  ctx.fillText("Score: "+score,10,20);
}

function gameLoop(timestamp){
  if(!lastTime) lastTime = timestamp;
  let delta = timestamp - lastTime;
  lastTime = timestamp;
  update(delta);
  draw();
  requestAnimationFrame(gameLoop);
}

reset();
requestAnimationFrame(gameLoop);
</script>
</body>
</html>